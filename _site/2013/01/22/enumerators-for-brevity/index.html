<!DOCTYPE html>
<html>
  <head>
    <title>Enumerators for brevity :: Joe Corcoran</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Joe Corcoran">
<script type="text/javascript" src="//use.typekit.net/lbi3uvk.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<link rel="stylesheet" href="/public/fa.min.css">

<link rel="stylesheet" href="/public/main.min.css" type="text/css" />
<link rel="alternate" type="application/atom+xml" href="/articles.xml" />
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3245696-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
    <header role="banner" class="banner">
  <div class="banner-content">
    <nav>
      <ul>
        <li><a href="/articles" class="active">Articles</a></li>
        <li><a href="/projects" >Projects</a></li>
      </ul>
    </nav>
    <a class="name" href="/" >Joe Corcoran</a>
  </div>
</header>

    <article class="post">
      <header>
        <h1>Enumerators for brevity</h1>
        <time datetime="2013-01-22T00:00:00+01:00">22 January 2013</time>
        

  <ul class="tags">
    
      <li>
        <a href="/tags/ruby">ruby</a>
      </li>
    
      <li>
        <a href="/tags/enumerable">enumerable</a>
      </li>
    
      <li>
        <a href="/tags/enumerator">enumerator</a>
      </li>
    
  </ul>


      </header>
      <p>I&rsquo;ve recently started to reach for Ruby&rsquo;s <code>Enumerator</code> class more often and thought it was worth a quick mention. The functionality I&rsquo;m focusing on here has been around since Ruby 1.8, but I rarely see it used in the wild.</p>

<!--more-->

<p><code>Enumerator#each_with_index</code> allows us to iterate through a collection of objects, with access to the index of each object.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">numbers</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span>
<span class="n">numbers</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="p">,</span> <span class="n">idx</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">number</span><span class="si">}</span><span class="s2"> at index </span><span class="si">#{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
<span class="c1"># 1 at index 0</span>
<span class="c1"># 2 at index 1</span>
<span class="c1"># etc.</span>
</code></pre></div>
<p>Passing the index into the block like that can be really useful, but <code>#each_with_index</code> is on its own; other common <code>Enumerable</code> methods are not afforded this kind of special extended treatment. Thankfully though, some of these methods return an <code>Enumerator</code> when they are used without a block.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">numbers</span><span class="o">.</span><span class="n">map</span> <span class="c1"># =&gt; #&lt;Enumerator: [1, 2, 3, 4, 5]:map&gt;</span>
</code></pre></div>
<p>This means we can chain <code>Enumerator</code> methods like <code>#with_index</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">numbers</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">with_index</span>
<span class="c1"># =&gt; #&lt;Enumerator: #&lt;Enumerator: [1, 2, 3, 4, 5]:map&gt;:with_index&gt;</span>
</code></pre></div>
<p>It&rsquo;s especially useful in places where you might otherwise use a placeholder array.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cities</span>    <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;New York City&#39;</span><span class="p">,</span> <span class="s1">&#39;Oslo&#39;</span><span class="o">]</span>
<span class="n">countries</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span> <span class="s1">&#39;Norway&#39;</span><span class="o">]</span>

<span class="n">places_1</span> <span class="o">=</span> <span class="o">[]</span>
<span class="n">cities</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="p">,</span> <span class="n">idx</span><span class="o">|</span>
  <span class="n">places_1</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">countries</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
<span class="c1"># places_1</span>
<span class="c1"># =&gt; [&#39;New York City, USA&#39;, &#39;Oslo, Norway&#39;]</span>

<span class="n">places_2</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="p">,</span> <span class="n">idx</span><span class="o">|</span>
  <span class="s2">&quot;</span><span class="si">#{</span><span class="n">city</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">countries</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
<span class="c1"># places_2</span>
<span class="c1"># =&gt; [&#39;New York City, USA&#39;, &#39;Oslo, Norway&#39;]</span>
</code></pre></div>
<p>Check out just how many <code>Enumerable</code> methods return an <code>Enumerator</code> by <a href="http://www.ruby-doc.org/core-1.9.3/Enumerable.html">searching this page</a> for &ldquo;an_enumerator&rdquo;.</p>

<p>There&rsquo;s more reading on this topic, including a decent explanation of the external iteration features introduced in 1.9, <a href="http://en.wikibooks.org/wiki/Ruby_Programming/Reference/Objects/Enumerable">over at Wikibooks</a>.</p>

    </article>
    <footer class="footer">
  <div class="footer-content">
    <ul>
      <li>
        <a href="mailto:joe@corcoran.io"><i class="fa fa-envelope"></i></a>
      </li>
      <li>
        <a href="http://twitter.com/josephcorcoran"><i class="fa fa-twitter"></i></a>
      </li>
      <li>
        <a href="/articles.xml"><i class="fa fa-rss"></i></a>
      </li>
  </div>
</footer>

  </body>
</html>
