<!DOCTYPE html>
<html>
  <head>
    <title>An update on Judge</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Joe Corcoran">
    <link rel="stylesheet" href="/css/main.css" type="text/css" />
    <link rel="stylesheet" href="/css/solarized-dark.css" type="text/css" />
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3245696-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </head>
  <body>
    <div id="container">
      <header>
        <h1>An update on Judge</h1>
        <time datetime="2012-04-13T00:00:00+01:00">13 April 2012<time>
        

  <ul class="tags">
    
      <li>
        <a href="/tags/judge">judge</a>
      </li>
    
      <li>
        <a href="/tags/ruby">ruby</a>
      </li>
    
      <li>
        <a href="/tags/javascript">javascript</a>
      </li>
    
      <li>
        <a href="/tags/activerecord">activerecord</a>
      </li>
    
      <li>
        <a href="/tags/i18n">i18n</a>
      </li>
    
      <li>
        <a href="/tags/rails">rails</a>
      </li>
    
      <li>
        <a href="/tags/validation">validation</a>
      </li>
    
  </ul>

      </header>
      <p>I&#8217;ve just released <a href="https://rubygems.org/gems/judge/versions/1.5.0">Judge 1.5.0</a> and since it&#8217;s been a while since the last update, I thought I&#8217;d run through some of the improvements that have been made since version 1.0.0 and also introduce some ideas for future improvements.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">gem</span> <span class="s2">&quot;judge&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 1.5.0&quot;</span>
</code></pre></div>

<!--more-->

<h2>Callbacks</h2>

<p>The various <code>validate()</code> methods now accept callback functions. Yep, real modern. The cool thing about this is that we can handle what happens after validation a little more elegantly. Behold!</p>

<p><code>watcher.validate([callback])</code></p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">watcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">judge</span><span class="p">.</span><span class="nx">Watcher</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
<span class="nx">watcher</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">valid</span><span class="p">,</span> <span class="nx">messages</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="nx">valid</span> <span class="o">?</span> <span class="s1">&#39;green&#39;</span> <span class="o">:</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>

<p><code>judge.validate(elements, [callback])</code></p>

<div class="highlight"><pre><code class="javascript"><span class="c1">// callback is executed once for each input</span>
<span class="nx">judge</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">valid</span><span class="p">,</span> <span class="nx">messages</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="nx">valid</span> <span class="o">?</span> <span class="s1">&#39;green&#39;</span> <span class="o">:</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>

<p><code>judge.store.validate(key, [callback])</code></p>

<div class="highlight"><pre><code class="javascript"><span class="nx">judge</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
<span class="c1">// callback is executed once for each element stored </span>
<span class="c1">// against key &#39;foo&#39; (in this case just once)</span>
<span class="nx">judge</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">valid</span><span class="p">,</span> <span class="nx">messages</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="nx">valid</span> <span class="o">?</span> <span class="s1">&#39;green&#39;</span> <span class="o">:</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>

<h2>I18n</h2>

<p>Internationalized error messages are sweet.  Remember when Rails didn&#8217;t do this?  Oh man. Bad times. They&#8217;re still a bit confusing though. There are a lot of bad custom validator examples sitting around on the web, just waiting to be copied and pasted into some poor, unsuspecting app. Don&#8217;t do this:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">FooValidator</span> <span class="o">&lt;</span> <span class="ss">ActiveModel</span><span class="p">:</span><span class="ss">:EachValidator</span>
  <span class="k">def</span> <span class="nf">validate_each</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;foo&quot;</span>
      <span class="n">record</span><span class="o">.</span><span class="n">errors</span><span class="o">[</span><span class="n">attribute</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;ain&#39;t foo&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><a href="http://en.wikipedia.org/wiki/Magic_number_(programming)">That rogue error message is doing nobody any favours</a>. The errors object has an <code>add</code> method which will handle i18n translation lookup for you:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">FooValidator</span> <span class="o">&lt;</span> <span class="ss">ActiveModel</span><span class="p">:</span><span class="ss">:EachValidator</span>
  <span class="k">def</span> <span class="nf">validate_each</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;foo&quot;</span>
      <span class="n">record</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="ss">:not_foo</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><a href="http://guides.rubyonrails.org/i18n.html#translations-for-active-record-models">You can read about how the error message is looked up over on rubyonrails.org</a>.</p>

<p>Since Judge is all about porting stuff from server- to client-side for great DRY justice, you can now use <code>declare_messages</code> in your custom <code>EachValidator</code> to specify which messages will be made available to your validation methods on the client-side:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">FooValidator</span> <span class="o">&lt;</span> <span class="ss">ActiveModel</span><span class="p">:</span><span class="ss">:EachValidator</span>
  <span class="n">declare_messages</span> <span class="ss">:not_foo</span>

  <span class="k">def</span> <span class="nf">validate_each</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;foo&quot;</span>
      <span class="n">record</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="ss">:not_foo</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>This means that we can access our translated message like this:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">judge</span><span class="p">.</span><span class="nx">customValidators</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">valid</span><span class="p">,</span> <span class="nx">messages</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">messages</span><span class="p">.</span><span class="nx">not_foo</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>

<h2>Documentation</h2>

<p>The <a href="http://judge.joecorcoran.co.uk">Judge docs</a> have been spruced up a little too. Please do let me know if anything is unclear.</p>

<h2>The future</h2>

<p>I have a few things that I&#8217;m planning on adding to Judge in the very near future.</p>

<h3>Uniqueness validation</h3>

<p>This isn&#8217;t currently possible with Judge but given the <a href="http://railscasts.com/episodes/277-mountable-engines?view=asciicast">updates to Engines in Rails >= 3.1</a>, I&#8217;m excited about tackling this issue in a clean, unobtrusive way. Watch this space.</p>

<h3>Backbone.Model validation</h3>

<p><a href="http://backbonejs.org/">Backbone.js</a> models have a <a href="http://backbonejs.org/#Model-validate">validate method</a> which, with a little extra work, I think could work really nicely with Judge. I&#8217;m not settled on how to implement this but I have some vague ideas. Suggestions welcome as always.</p>

      <section class="comments">
        <p>
  <a href="#" id="show_comments">Show comments</a>
</p>
<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'joecorcoran',
    disqus_title     = 'An update on Judge - Lapping it up with open arms',
    showComments     = function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    },
    commentsLink = document.getElementById('show_comments');
commentsLink.onclick = function() {
  showComments();
  commentsLink.style.display = 'none';
  return false;
};
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </section>
      <footer>
        <p>
          <a href="/" class="back">Back to index</a>
        </p>
        <h2>Related posts</h2>
        <section class="posts">
          
            
          
            
              <article>
  <time datetime="2011-11-15T00:00:00+00:00">15 November 2011</time>
  <div class="content">
    <a href=/2011/11/15/judge-simple-javascript-form-validation-for-rails>Judge: Simple JavaScript form validation for Rails</a>
    

  <ul class="tags">
    
      <li>
        <a href="/tags/judge">judge</a>
      </li>
    
      <li>
        <a href="/tags/javascript">javascript</a>
      </li>
    
      <li>
        <a href="/tags/ruby">ruby</a>
      </li>
    
      <li>
        <a href="/tags/rails">rails</a>
      </li>
    
      <li>
        <a href="/tags/activerecord">activerecord</a>
      </li>
    
      <li>
        <a href="/tags/validation">validation</a>
      </li>
    
  </ul>

  </div>
</article>
            
          
            
              <article>
  <time datetime="2010-09-01T21:37:00+01:00">01 September 2010</time>
  <div class="content">
    <a href=/2010/09/01/when-sammy-met-jasmine>When Sammy Met Jasmine</a>
    

  <ul class="tags">
    
      <li>
        <a href="/tags/javascript">javascript</a>
      </li>
    
      <li>
        <a href="/tags/sammy">sammy</a>
      </li>
    
      <li>
        <a href="/tags/testing">testing</a>
      </li>
    
      <li>
        <a href="/tags/bdd">bdd</a>
      </li>
    
      <li>
        <a href="/tags/jasmine">jasmine</a>
      </li>
    
      <li>
        <a href="/tags/jquery">jquery</a>
      </li>
    
  </ul>

  </div>
</article>
            
          
            
              <article>
  <time datetime="2009-07-02T00:00:00+01:00">02 July 2009</time>
  <div class="content">
    <a href=/2009/07/02/practical-uses-for-sammy>Practical uses for Sammy</a>
    

  <ul class="tags">
    
      <li>
        <a href="/tags/sammy">sammy</a>
      </li>
    
      <li>
        <a href="/tags/javascript">javascript</a>
      </li>
    
      <li>
        <a href="/tags/jquery">jquery</a>
      </li>
    
      <li>
        <a href="/tags/cycle">cycle</a>
      </li>
    
      <li>
        <a href="/tags/accordion">accordion</a>
      </li>
    
      <li>
        <a href="/tags/rest">rest</a>
      </li>
    
  </ul>

  </div>
</article>
            
          
        <section>
      </footer>
    </div>
  </body>
</html>